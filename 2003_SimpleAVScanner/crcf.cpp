/////////////////////////////////////////////////////
// Filename: <crcf.cpp>

///////////////////////////////////////////////
#include <fstream>
#include <sstream>
#include <windows.h>
///////////////////////////////////////////////

///////////////////////////////////////////////
using namespace std;
///////////////////////////////////////////////

///////////////////////////////////////////////
void InitCrcTable(void);              // Initialize the CRC table
ULONG Reflect(ULONG , char);          // Reflection 
int Get_CRC(unsigned char*, ULONG);   // Returns CRC value
ULONG FileSize(ifstream &);           // Returns File size
///////////////////////////////////////////////

///////////////////////////////////////////////
ULONG crc32_table[256];
ULONG ulPolynomial = 0x04c11db7;
///////////////////////////////////////////////

///////////////////////////////////////////////
string IntToString(unsigned int num)
{
  ostringstream myStream;
  myStream << num << flush;

  return(myStream.str());
}
///////////////////////////////////////////////

///////////////////////////////////////////////
void InitCrcTable() 
{
	for(int i = 0; i <= 0xFF; i++)
	{
		crc32_table[i]=Reflect(i, 8) << 24;
		for (int j = 0; j < 8; j++)
			crc32_table[i] = (crc32_table[i] << 1) ^ (crc32_table[i] & (1 << 31) ? ulPolynomial : 0);
		crc32_table[i] = Reflect(crc32_table[i], 32);
	}
}
///////////////////////////////////////////////

///////////////////////////////////////////////
ULONG Reflect(ULONG ref, char ch)
{ 
	ULONG value(0);

	for(int i = 1; i < (ch + 1); i++)
	{
		if(ref & 1)
			value |= 1 << (ch - i);
		ref >>= 1;
	}
	return value;
}
///////////////////////////////////////////////

///////////////////////////////////////////////
int Get_CRC(unsigned char* buffer, ULONG bufsize)
{
	ULONG  crc(0xffffffff);
	int len;
	len = bufsize;

	for(int i = 0; i < len; i++)
	  crc = (crc >> 8) ^ crc32_table[(crc & 0xFF) ^ buffer[i]];

	return crc^0xffffffff;
}
///////////////////////////////////////////////

///////////////////////////////////////////////
ULONG FileSize(ifstream &in)
{
	in.seekg(0, ios::end); 
	return in.tellg();
}
///////////////////////////////////////////////